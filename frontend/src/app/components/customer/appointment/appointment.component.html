<div class="appointment-container">
  <!-- Header Section -->
  <div class="appointment-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">
          <i class="fas fa-calendar-check"></i>
          Book Your Appointment
        </h1>
        <p class="page-subtitle">Schedule your car wash service with ease</p>
      </div>
      <div class="header-right">
        <div class="available-slots-card">
          <div class="slots-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="slots-info">
            <span class="slots-label">Available Slots</span>
            <span class="slots-count">{{ availableSlots }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="appointment-content">
    <div class="form-container">
      <div class="form-header">
        <h2>Service Details</h2>
        <p>Fill in the details below to book your car wash appointment</p>
      </div>

      <form
        class="booking-form"
        (ngSubmit)="submitBooking()"
        autocomplete="off"
      >
        <!-- Vehicle and Service Selection -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-car"></i>
            <span>Vehicle & Service</span>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Vehicle Type*</mat-label>
              <mat-select
                [(ngModel)]="bookingForm.vehicleType"
                name="vehicleType"
                required
              >
                <mat-option *ngFor="let type of vehicleTypes" [value]="type">
                  <i class="fas fa-car"></i> {{ type }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Select Services*</mat-label>
              <mat-select
                [(ngModel)]="bookingForm.services"
                name="services"
                required
              >
                <mat-option
                  *ngFor="let service of services"
                  [value]="service.name"
                >
                  <div class="service-option">
                    <span class="service-name">{{ service.name }}</span>
                    <span class="service-details"
                      >₱{{ service.price }} •
                      {{ service.duration_minutes }} mins</span
                    >
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-user"></i>
            <span>Personal Information</span>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>First Name*</mat-label>
              <input
                matInput
                [(ngModel)]="bookingForm.firstName"
                name="firstName"
                required
                readonly
                placeholder="Your first name"
              />
              <mat-icon matSuffix>person</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Last Name*</mat-label>
              <input
                matInput
                [(ngModel)]="bookingForm.lastName"
                name="lastName"
                required
                readonly
                placeholder="Your last name"
              />
              <mat-icon matSuffix>person</mat-icon>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nickname*</mat-label>
              <input
                matInput
                [(ngModel)]="bookingForm.nickname"
                name="nickname"
                required
                placeholder="Enter your nickname"
              />
              <mat-icon matSuffix>person</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Phone Number*</mat-label>
              <input
                matInput
                [(ngModel)]="bookingForm.phone"
                name="phone"
                required
                readonly
                placeholder="Your phone number"
              />
              <mat-icon matSuffix>phone</mat-icon>
            </mat-form-field>
          </div>

          <div class="form-row single-field">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Additional Phone Number</mat-label>
              <input
                matInput
                [(ngModel)]="bookingForm.additionalPhone"
                name="additionalPhone"
                placeholder="Alternative phone number (optional)"
              />
              <mat-icon matSuffix>phone</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Schedule -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-calendar-alt"></i>
            <span>Schedule</span>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Wash Date*</mat-label>
              <input
                matInput
                [matDatepicker]="picker"
                [(ngModel)]="bookingForm.washDate"
                name="washDate"
                required
                placeholder="Select wash date"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Wash Time*</mat-label>
              <input
                matInput
                type="time"
                [(ngModel)]="bookingForm.washTime"
                name="washTime"
                required
                placeholder="Select wash time"
                (click)="openTimePicker()"
                readonly
                class="time-input-field"
              />
              <mat-icon
                matSuffix
                class="time-picker-icon"
                (click)="openTimePicker()"
                >schedule</mat-icon
              >

              <!-- Custom Time Picker Overlay -->
              <div
                class="time-picker-overlay"
                *ngIf="showTimePicker"
                (click)="closeTimePicker($event)"
              >
                <div
                  class="time-picker-panel"
                  (click)="$event.stopPropagation()"
                >
                  <div class="time-picker-header">
                    <h3>Select Wash Time</h3>
                    <button class="close-btn" (click)="closeTimePicker($event)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>

                  <!-- Manual Time Input -->
                  <div class="manual-time-section">
                    <label>Or enter time manually:</label>
                    <div class="manual-time-inputs">
                      <input
                        type="number"
                        min="0"
                        max="23"
                        [(ngModel)]="manualHour"
                        placeholder="HH"
                        class="time-input-hour"
                        (input)="updateManualTime()"
                      />
                      <span class="time-separator">:</span>
                      <input
                        type="number"
                        min="0"
                        max="59"
                        [(ngModel)]="manualMinute"
                        placeholder="MM"
                        class="time-input-minute"
                        (input)="updateManualTime()"
                      />
                    </div>
                  </div>

                  <!-- Available Time Slots -->
                  <div class="time-slots-section">
                    <label>Available Time Slots:</label>
                    <div class="time-slots-grid">
                      <button
                        *ngFor="let slot of availableTimeSlots"
                        class="time-slot-btn"
                        [class.selected]="isTimeSlotSelected(slot)"
                        (click)="selectTimeSlot(slot)"
                        [disabled]="!isTimeSlotAvailable(slot)"
                      >
                        {{ formatTimeSlot(slot) }}
                      </button>
                    </div>
                  </div>

                  <!-- Quick Time Buttons -->
                  <div class="quick-time-section">
                    <label>Quick Selection:</label>
                    <div class="quick-time-buttons">
                      <button
                        class="quick-time-btn"
                        (click)="setQuickTime('09:00')"
                      >
                        9:00 AM
                      </button>
                      <button
                        class="quick-time-btn"
                        (click)="setQuickTime('12:00')"
                      >
                        12:00 PM
                      </button>
                      <button
                        class="quick-time-btn"
                        (click)="setQuickTime('15:00')"
                      >
                        3:00 PM
                      </button>
                      <button
                        class="quick-time-btn"
                        (click)="setQuickTime('17:00')"
                      >
                        5:00 PM
                      </button>
                    </div>
                  </div>

                  <div class="time-picker-actions">
                    <button
                      class="btn-cancel"
                      (click)="closeTimePicker($event)"
                    >
                      Cancel
                    </button>
                    <button
                      class="btn-confirm"
                      (click)="confirmTimeSelection()"
                    >
                      Confirm Time
                    </button>
                  </div>
                </div>
              </div>
            </mat-form-field>
          </div>
        </div>

        <!-- Payment -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-credit-card"></i>
            <span>Payment</span>
          </div>

          <div class="form-row">
            <mat-form-field
              appearance="outline"
              class="form-field payment-type-field"
            >
              <mat-label>Payment Type*</mat-label>
              <mat-select
                [(ngModel)]="bookingForm.paymentType"
                name="paymentType"
                required
                (selectionChange)="onPaymentTypeChange()"
              >
                <mat-option *ngFor="let type of paymentTypes" [value]="type">
                  <i class="fas fa-credit-card"></i> {{ type }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Online Payment Sub-options -->
          <div
            class="form-row online-payment-options"
            *ngIf="bookingForm.paymentType === 'Online Payment'"
          >
            <div class="online-payment-header">
              <i class="fas fa-mobile-alt"></i>
              <span>Select Payment Method</span>
            </div>
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Payment Method*</mat-label>
              <mat-select
                [(ngModel)]="bookingForm.onlinePaymentOption"
                name="onlinePaymentOption"
                required
              >
                <mat-option
                  *ngFor="let option of onlinePaymentOptions"
                  [value]="option"
                >
                  <i class="fas fa-mobile-alt"></i> {{ option }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- Additional Notes -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-sticky-note"></i>
            <span>Additional Information</span>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea
              matInput
              [(ngModel)]="bookingForm.notes"
              name="notes"
              rows="3"
              placeholder="Any special instructions or additional notes..."
              style="width: 100%; min-height: 100px; resize: vertical"
            ></textarea>
          </mat-form-field>
        </div>

        <!-- Messages -->
        <div class="messages-container" *ngIf="errorMessage || successMessage">
          <div class="message error-message" *ngIf="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            {{ errorMessage }}
          </div>
          <div class="message success-message" *ngIf="successMessage">
            <i class="fas fa-check-circle"></i>
            {{ successMessage }}
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="isSubmitting"
            class="submit-button"
          >
            <i class="fas fa-calendar-plus" *ngIf="!isSubmitting"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
            {{ isSubmitting ? "Booking..." : "Book Appointment" }}
          </button>
        </div>
      </form>
    </div>

    <!-- Sidebar with Tips -->
    <div class="appointment-sidebar">
      <div class="sidebar-card">
        <div class="card-header">
          <i class="fas fa-lightbulb"></i>
          <h3>Booking Tips</h3>
        </div>
        <div class="card-content">
          <ul class="tips-list">
            <li>
              <i class="fas fa-clock"></i>
              <span>Book at least 2 hours in advance</span>
            </li>
            <li>
              <i class="fas fa-car"></i>
              <span>Ensure your vehicle is accessible</span>
            </li>
            <li>
              <i class="fas fa-phone"></i>
              <span>Keep your phone nearby for updates</span>
            </li>
            <li>
              <i class="fas fa-credit-card"></i>
              <span>Payment is processed after service completion</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="card-header">
          <i class="fas fa-info-circle"></i>
          <h3>Service Hours</h3>
        </div>
        <div class="card-content">
          <div class="hours-info">
            <div class="hours-row">
              <span class="day">Monday - Friday</span>
              <span class="time">8:00 AM - 6:00 PM</span>
            </div>
            <div class="hours-row">
              <span class="day">Saturday</span>
              <span class="time">9:00 AM - 5:00 PM</span>
            </div>
            <div class="hours-row">
              <span class="day">Sunday</span>
              <span class="time">10:00 AM - 4:00 PM</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
